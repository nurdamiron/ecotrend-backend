FROM node:16-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

# Ensure MySQL is ready before running tests
CMD ["sh", "-c", "sleep 20 && NODE_ENV=test npm test -- --forceExit"]